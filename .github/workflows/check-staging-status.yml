name: Check Staging Environment Status

on:
  workflow_dispatch:  # ÊâãÂãïÂÆüË°åÂ∞ÇÁî®

permissions:
  contents: read

jobs:
  check-staging:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check S3 staging environment status
      run: |
        echo "üîç Checking S3 staging environment status..."
        
        BUCKET_NAME="${{ secrets.S3_BUCKET_STAGING }}"
        
        # „Éê„Ç±„ÉÉ„Éà„ÅÆÂ≠òÂú®Á¢∫Ë™ç
        if aws s3api head-bucket --bucket $BUCKET_NAME 2>/dev/null; then
          echo "‚úÖ Bucket exists: $BUCKET_NAME"
          
          # „Éê„Ç±„ÉÉ„ÉàÂÜÖ„ÅÆ„Éï„Ç°„Ç§„É´Êï∞„ÇíÁ¢∫Ë™ç
          FILE_COUNT=$(aws s3 ls s3://$BUCKET_NAME --recursive | wc -l)
          echo "üìÅ Files in bucket: $FILE_COUNT"
          
          # „Ç¶„Çß„Éñ„Çµ„Ç§„ÉàË®≠ÂÆöÁ¢∫Ë™ç
          if aws s3api get-bucket-website --bucket $BUCKET_NAME 2>/dev/null; then
            echo "üåê Website hosting: ENABLED"
            echo "üåê URL: http://$BUCKET_NAME.s3-website-ap-northeast-1.amazonaws.com"
          else
            echo "üåê Website hosting: DISABLED"
          fi
          
          # Êé®ÂÆöÊúàÈ°çÊñôÈáëË®àÁÆó
          STORAGE_GB=$(echo "scale=6; $FILE_COUNT * 0.001" | bc -l 2>/dev/null || echo "0.001")
          COST=$(echo "scale=2; $STORAGE_GB * 0.025" | bc -l 2>/dev/null || echo "0.01")
          echo "üí∞ Estimated monthly cost: ~$${COST} USD"
          
        else
          echo "‚ùå Bucket does not exist: $BUCKET_NAME"
          echo "‚úÖ No charges are occurring"
          echo "üí∞ Monthly cost: $0.00 USD"
        fi
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_DEFAULT_REGION: ap-northeast-1